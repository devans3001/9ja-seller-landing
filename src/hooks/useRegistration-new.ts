// New registration hook - implement from scratch